<script>
    function newThread(){
        $('.modal').modal('open');
    }
    $("#edit-fab").click(newThread);

    function submitThread(){
        $("#submitThreadButton").addClass("disabled")
        var formObject = {}
        var formArray = $("#getthread").serializeArray();
        $.each(formArray, function (i, item) {
            formObject[item.name] = item.value;
        });
        $.ajax({
            url: "/api/thread/" + formObject['thread'],
            type: "POST",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(formObject),
            dataType: "json",
            success: function (data) {
                console.log(data)
                console.log(data.data)
                $('#leftDiv').remove();
                $('#rightDiv').remove();
                $('#getThreadCard').remove();
                $('#mainContainerRow').append(`<div class="waves-effect waves-teal btn-flat" id="backToIndex"><i class="small material-icons">chevron_left</i><span>返回</span></div>`)
                $('#backToIndex').click(function (){
                    $('#mainContainerRow').empty();
                    $('#mainContainerRow').append(`<div class="col l3" id="leftDiv"></div>
                    <div class="col s12 l6" id="getThreadCard">
                      <div class="card-panel white">
                        <form id="getthread">
                          <div class="input-field">
                            <input id="thread" name="thread" type="text" class="validate">
                            <label for="thread">讨论串号</label>
                          </div>
                          <input type="hidden" name="action" value="get">
                          <button class="btn waves-effect waves-light" id="submitThreadButton" type="button">前往
                            <i class="material-icons right">send</i>
                          </button>
                        </form>
                      </div>
                    </div>
                    <div class="col l3" id="rightDiv"></div>`)
                    $('#submitThreadButton').click(submitThread);
                    history.pushState({}, "index", "/");
                })
                for (var i in data.data) {
                    thread = data.data[i]
                    $('#mainContainerRow').append(`<div class="col l12 s12 card-panel white thread-card" id="thread-${thread['thread']}">
                        <div class="card-content">
                            <div class="content" id="content-${thread['thread']}">${thread['content']}</div>
                            <div class="thread-metadata">
                                <span class="grey-text username"><i class="tiny material-icons">account_box</i>${thread['username']}</span>
                                <span class="grey-text time"><i class="tiny material-icons">access_time</i>${thread['time']}</span>
                            </div>
                        </div>
                    </div>`);
                }
                history.pushState({}, "index", "/thread/"+thread['thread']);
            },
            error: function(e) {
                console.log(e)
                M.toast({html: `${e['status']} - ${e['statusText']}`})
                $("#submitThreadButton").removeClass("disabled")
            }
        });
    }
    $('#submitThreadButton').click(submitThread)
</script>